<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

 <title>Book Collection</title>
 <style>
  * {
    box-sizing: border-box;
  }
  

  .column {
    float: left;
    width: 50%;
    padding: 10px;
    height: 300px; /* Should be removed. Only for demonstration */
  }
  
  .button{
    width: 15%;
  }
  
  .bookHeader{
    width: 40%;
  }

  .textInput{
    width: 90%;
    padding: 7px 14px;
  }

  .descInput{
    width: 90%;
    padding: 7px 14px;
  }

  h1{
    text-align: center;
  }
  

  .row:after {
    content: "";
    display: table;
    clear: both;
  }
  </style>
</head>

<body>
  <h1>Book Collection</h1>
  
   <div class="row">
    <div class="column">

   <form action="/books" method="patch">
    Title:<br/>
    <input id="titleForm" type="text" name="Title" class="textInput">
    <br/>
    <br/>
    Author:<br/>
    <input id="authorForm" type="text" name="Author" class="textInput">
    <br/>
    <br/> Description:<br/>
    <textarea id="descriptionForm" name="Text1" cols="40" rows="5" class="descInput">
    
    </textarea>
    <br/><br/>
    <input id=saveNewBtn type="button" value="Save New" class="button" disabled=true onclick="saveNewBook()">
    <input id=saveBtn type="button" value="Save" class="button" disabled=true onclick="updateBook()"> 
    <input id=deleteBtn type="button" value="Delete" class="button" disabled=true>
  </form>
  </table>
  </div>
</th>

  <div class="column">
  <table width=90%>
    <tr>
      <th width=20% >Title</th>
      <th width=20% >Author</th>
      <th width=50% >Description</th>
    </tr>
    </tr>
  </table>
</div>
</div>
  <br/>

  <script>


    bookTable = document.querySelector("table")
    let selectedtd
    bookTable.onclick = function (event){
      let target = event.target.closest('tr');
      // If we miss entirely, let's pretend we didn't.
      if (target != null){
      // Clicking on header row? Let's ignore that.  
        if (target.id == '') return;
        clickHandler(target)
      }else{
        return;
      }
    }

    fetch("/books")
      .then(response => response.json())
      .then(bookList => {
        
        bookList.forEach(book => {
          
          // Create the table row
          row = document.createElement("tr")
          row.id = "row" + book.id
          
          title = document.createElement("td")
          title.id = "title_"+row.id
          title.innerHTML = book.title
          author = document.createElement("td")
          author.id = "author_"+row.id
          author.innerHTML = book.author
          description = document.createElement("td")
          description.id = "description_"+row.id
          description.innerHTML = book.description
  
          

          row.appendChild(title);
          row.appendChild(author);
          row.appendChild(description);
          
          bookTable.appendChild(row)

        })
      })

      // ClickHandler, when clicking on list of books.
      function clickHandler(input){
        backupFormData();

        // Transfer data from clicked row to form.
        document.getElementById("titleForm").value = document.getElementById("title_"+input.id).innerHTML;
        document.getElementById("authorForm").value = document.getElementById("author_"+input.id).innerHTML;
        document.getElementById("descriptionForm").value =  document.getElementById("description_"+input.id).innerHTML;
        // Enabling Save button 
        document.getElementById("saveBtn").disabled = false;
        // Enabling Delete button
        document.getElementById("deleteBtn").disabled = false;
        //Debugging console output.
        //console.log(input.id);
        
      }

      function changeInput(){
        
      }
      
      function backupFormData(){
        // Clear previous values
        sessionStorage.removeItem("prevID");
        sessionStorage.removeItem("prevTitle");
        sessionStorage.removeItem("prevAuthor");
        sessionStorage.removeItem("prevDescription");
        // Temporary variables for saving data
        
        titleTemp = document.getElementById("titleForm").value;
        authorTemp = document.getElementById("authorForm").value;
        descriptionTemp = document.getElementById("descriptionForm").value;    
        
        sessionStorage.setItem("prevTitle",titleTemp);
        sessionStorage.setItem("prevAuthor",authorTemp);
        sessionStorage.setItem("prevDescription",descriptionTemp);

        //document.getElementById("titleForm").value = sessionStorage.getItem("defaultTitle");
        console.log(titleTemp);
        console.log(authorTemp);
        console.log(descriptionTemp);
      }
      
      // Send new book data to backend.
      function saveNewBook(){

      }

      // Send updated book data to backend.
      function updateBook(){

      }
      // Remove book from database.
      function deleteBook(){

      }
  </script>
</body>